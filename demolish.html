<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Wall - Mega-Shake Edition</title>
    <style>
        body { background: #020617; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; }
        .back-link { position: absolute; top: 20px; left: 20px; text-decoration: none; color: #38bdf8; font-weight: bold; z-index: 100; }
        canvas { background: #000; border: 2px solid #1e293b; max-width: 95vw; max-height: 80vh; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        .ui { position: absolute; top: 20px; text-align: center; pointer-events: none; }
    </style>
</head>
<body>

    <a href="index.html" class="back-link">‚Üê BACK TO ARCADE</a>
    
    <div class="ui">
        <div style="color: #38bdf8; font-size: 1.5rem; font-weight: bold; font-family: 'Rajdhani', sans-serif;">THE WALL</div>
        <div style="color: #64748b;">Drag to sweep the wall with balls</div>
    </div>

    <canvas id="wallCanvas" width="800" height="600"></canvas>

<script>
    const canvas = document.getElementById("wallCanvas");
    const ctx = canvas.getContext("2d");

    let balls = [];
    let bricks = [];
    let isFiring = false;
    let mouse = { x: 400, y: 300 };
    let winTriggered = false;
    let shakeIntensity = 0;

    // --- INITIALIZE MEGA-WALL (240 BRICKS) ---
    function initBricks() {
        bricks = [];
        const rows = 12, cols = 20;
        const w = 32, h = 18;
        const padding = 3;
        const startX = (canvas.width - (cols * (w + padding))) / 2;

        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                bricks.push({
                    x: startX + c * (w + padding),
                    y: 80 + r * (h + padding),
                    w: w, h: h, active: true,
                    color: `hsl(${(r * 12) + (c * 6)}, 75%, 55%)`
                });
            }
        }
    }

    function resetGame() {
        balls = [];
        winTriggered = false;
        shakeIntensity = 0;
        initBricks();
    }

    // --- INPUT HANDLING ---
    function updateInput(clientX, clientY) {
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        mouse.x = (clientX - rect.left) * scaleX;
        mouse.y = (clientY - rect.top) * scaleY;
    }

    const handleStart = (clientX, clientY) => {
        if (winTriggered) resetGame();
        else { isFiring = true; updateInput(clientX, clientY); }
    };

    canvas.addEventListener('mousedown', (e) => handleStart(e.clientX, e.clientY));
    window.addEventListener('mouseup', () => isFiring = false);
    canvas.addEventListener('mousemove', (e) => updateInput(e.clientX, e.clientY));

    canvas.addEventListener('touchstart', (e) => { 
        handleStart(e.touches[0].clientX, e.touches[0].clientY);
    }, { passive: false });
    canvas.addEventListener('touchend', () => isFiring = false);
    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        updateInput(e.touches[0].clientX, e.touches[0].clientY);
    }, { passive: false });

    function triggerShake(amt) { shakeIntensity = amt; }

    function update() {
        if (isFiring && !winTriggered) {
            balls.push({
                x: 400, y: 580,
                vx: (mouse.x - 400) * 0.07,
                vy: (mouse.y - 580) * 0.07,
                r: 7
            });
        }

        if (shakeIntensity > 0) shakeIntensity *= 0.9;

        balls.forEach((b, bi) => {
            b.x += b.vx; b.y += b.vy;
            b.vy += 0.18; // Gravity

            bricks.forEach(br => {
                if (br.active && b.x > br.x && b.x < br.x + br.w && b.y > br.y && b.y < br.y + br.h) {
                    br.active = false;
                    b.vy *= -0.5;
                    triggerShake(3);
                }
            });
            if (b.y > 650) balls.splice(bi, 1);
        });

        if (!winTriggered && bricks.length > 0 && bricks.every(b => !b.active)) {
            winTriggered = true;
            isFiring = false;
            triggerShake(20); // Massive victory shake
        }
    }

    function draw() {
        ctx.save();
        
        // SHAKE EFFECT
        if (shakeIntensity > 0.5) {
            ctx.translate((Math.random()-0.5)*shakeIntensity, (Math.random()-0.5)*shakeIntensity);
        }

        ctx.fillStyle = "#020617";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // BRICKS
        bricks.forEach(br => {
            if (br.active) {
                ctx.fillStyle = br.color;
                ctx.fillRect(br.x, br.y, br.w, br.h);
            }
        });

        // BALLS
        ctx.fillStyle = "#38bdf8";
        balls.forEach(b => {
            ctx.beginPath(); ctx.arc(b.x, b.y, b.r, 0, Math.PI*2); ctx.fill();
        });

        ctx.restore();

        // VICTORY UI (Doesn't shake)
        if (winTriggered) {
            ctx.fillStyle = "rgba(0,0,0,0.7)";
            ctx.fillRect(0,0,canvas.width,canvas.height);
            
            ctx.fillStyle = "#fff";
            ctx.textAlign = "center";
            ctx.font = "bold 50px Segoe UI";
            ctx.fillText("CONGRATULATIONS PAWAN!", 400, 280);
            
            ctx.fillStyle = "#38bdf8";
            ctx.font = "24px Segoe UI";
            ctx.fillText("YOU HAVE CONQUERED THE ARCADE", 400, 330);
            
            ctx.fillStyle = "#64748b";
            ctx.font = "18px Segoe UI";
            ctx.fillText("Tap anywhere to play again", 400, 390);
        }
    }

    function loop() {
        update(); draw();
        requestAnimationFrame(loop);
    }

    initBricks();
    loop();
</script>
</body>
</html>
