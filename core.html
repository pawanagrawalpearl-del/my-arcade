<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core Defender - Laser Edition</title>
    <style>
        body {
            background: #020617;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden;
        }
        
        .back-link {
            position: absolute;
            top: 20px;
            left: 20px;
            text-decoration: none;
            color: #38bdf8;
            font-weight: bold;
            z-index: 10;
        }
        
        canvas {
            background: #000;
            border: 2px solid #1e293b;
            border-radius: 50%;
            cursor: none;
        }
        
        .ui {
            position: absolute;
            top: 20px;
            text-align: center;
            pointer-events: none;
        }
        
        #score {
            font-size: 2.5rem;
            font-weight: bold;
            color: #38bdf8;
        }
    </style>
</head>

<body>

    <a href="index.html" class="back-link">‚Üê BACK TO ARCADE</a>

    <div class="ui">
        <div id="score">0</div>
        <div style="color: #64748b;">Sweep the Laser to Destroy Swarms</div>
    </div>

    <canvas id="coreCanvas" width="600" height="600"></canvas>

    <script>
        const canvas = document.getElementById("coreCanvas");
        const ctx = canvas.getContext("2d");
        const scoreDisplay = document.getElementById("score");

        let score = 0;
        let gameOver = false;
        let enemies = [];
        let particles = [];
        let spawnRate = 800;
        let lastSpawn = 0;
        let mouse = {
            x: 0,
            y: 0
        };

        const core = {
            x: 300,
            y: 300,
            r: 40
        };

        function spawnEnemy() {
            const angle = Math.random() * Math.PI * 2;
            const dist = 350;
            enemies.push({
                x: core.x + Math.cos(angle) * dist,
                y: core.y + Math.sin(angle) * dist,
                r: 12,
                speed: 1.2 + (score / 4000),
                color: `hsl(${Math.random() * 360}, 80%, 60%)`
            });
        }

        // TRACK CURSOR POSITION
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            mouse.x = e.clientX - rect.left;
            mouse.y = e.clientY - rect.top;
        });

        canvas.addEventListener('click', () => {
            if (gameOver) reset();
        });

        function createExplosion(x, y, color) {
            for (let i = 0; i < 8; i++) {
                particles.push({
                    x,
                    y,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8,
                    alpha: 1,
                    color
                });
            }
        }

        function reset() {
            score = 0;
            enemies = [];
            particles = [];
            gameOver = false;
            scoreDisplay.innerText = "0";
            animate();
        }

        function update(time) {
            if (gameOver) return;

            if (time - lastSpawn > spawnRate) {
                spawnEnemy();
                lastSpawn = time;
                spawnRate = Math.max(250, 800 - (score / 20));
            }

            // POINT-TO-BALL DETECTION (No clicking needed)
            for (let i = enemies.length - 1; i >= 0; i--) {
                const en = enemies[i];
                const angle = Math.atan2(core.y - en.y, core.x - en.x);
                en.x += Math.cos(angle) * en.speed;
                en.y += Math.sin(angle) * en.speed;

                // Check if cursor is touching enemy
                const distToMouse = Math.sqrt((mouse.x - en.x) ** 2 + (mouse.y - en.y) ** 2);
                if (distToMouse < en.r + 10) {
                    createExplosion(en.x, en.y, en.color);
                    enemies.splice(i, 1);
                    score += 10;
                    scoreDisplay.innerText = score;
                    continue;
                }

                // Core Collision
                const distToCore = Math.sqrt((core.x - en.x) ** 2 + (core.y - en.y) ** 2);
                if (distToCore < core.r) gameOver = true;
            }

            particles.forEach((p, i) => {
                p.x += p.vx;
                p.y += p.vy;
                p.alpha -= 0.04;
                if (p.alpha <= 0) particles.splice(i, 1);
            });
        }

        function draw(time) {
            ctx.fillStyle = 'rgba(2, 6, 23, 0.3)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // DRAW LASER BEAM
            ctx.beginPath();
            ctx.moveTo(core.x, core.y);
            ctx.lineTo(mouse.x, mouse.y);
            ctx.strokeStyle = "rgba(56, 189, 248, 0.4)";
            ctx.lineWidth = 2;
            ctx.stroke();

            // DRAW CROSSHAIR
            ctx.beginPath();
            ctx.arc(mouse.x, mouse.y, 10, 0, Math.PI * 2);
            ctx.strokeStyle = "#38bdf8";
            ctx.stroke();

            // CORE
            ctx.beginPath();
            ctx.arc(core.x, core.y, core.r, 0, Math.PI * 2);
            ctx.strokeStyle = `hsl(${(time / 10) % 360}, 80%, 60%)`;
            ctx.lineWidth = 5;
            ctx.stroke();

            // ENEMIES
            enemies.forEach(en => {
                ctx.beginPath();
                ctx.arc(en.x, en.y, en.r, 0, Math.PI * 2);
                ctx.fillStyle = en.color;
                ctx.shadowBlur = 10;
                ctx.shadowColor = en.color;
                ctx.fill();
                ctx.shadowBlur = 0;
            });

            // PARTICLES
            particles.forEach(p => {
                ctx.globalAlpha = p.alpha;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 3, 3);
            });
            ctx.globalAlpha = 1;

            if (gameOver) {
                ctx.fillStyle = "rgba(0,0,0,0.8)";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = "white";
                ctx.textAlign = "center";
                ctx.font = "bold 35px Rajdhani";
                ctx.fillText("DEFENSE BREACHED", 300, 280);
                ctx.font = "20px Rajdhani";
                ctx.fillText("SCORE: " + score, 300, 320);
                ctx.fillText("Click to Reboot", 300, 360);
            }
        }

        function loop(time) {
            update(time);
            draw(time);
            requestAnimationFrame(loop);
        }

        loop();
    </script>
</body>

</html>