<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Repulsor Pop - Ultra Edition</title>
    <style>
        body { background: #000; margin: 0; overflow: hidden; touch-action: none; }
        canvas { display: block; }
        .back-link { position: absolute; top: 20px; left: 20px; color: #38bdf8; text-decoration: none; font-weight: bold; font-family: sans-serif; z-index: 10; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê BACK</a>
    <canvas id="gravityCanvas"></canvas>

<script>
    const canvas = document.getElementById('gravityCanvas');
    const ctx = canvas.getContext('2d');

    let particles = [];
    // INCREASED COUNT: From ~150 to 1500 for that "Triple A" app feel
    const particleCount = 1500; 
    let mouse = { x: -1000, y: -1000, active: false };

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        initParticles();
    }

    function initParticles() {
        particles = [];
        for (let i = 0; i < particleCount; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                vx: (Math.random() - 0.5) * 2,
                vy: (Math.random() - 0.5) * 2,
                size: Math.random() * 2 + 0.5,
                color: `hsl(${Math.random() * 60 + 180}, 80%, 60%)` // Neon blues/cyans
            });
        }
    }

    function handleInput(x, y, active) {
        mouse.x = x;
        mouse.y = y;
        mouse.active = active;
    }

    window.addEventListener('mousemove', e => handleInput(e.clientX, e.clientY, true));
    window.addEventListener('mousedown', () => mouse.active = true);
    window.addEventListener('mouseup', () => mouse.active = false);

    window.addEventListener('touchstart', e => {
        handleInput(e.touches[0].clientX, e.touches[0].clientY, true);
    }, { passive: false });
    window.addEventListener('touchmove', e => {
        handleInput(e.touches[0].clientX, e.touches[0].clientY, true);
    }, { passive: false });
    window.addEventListener('touchend', () => mouse.active = false);

    function animate() {
        // TRAIL EFFECT: Instead of clearRect, we use a fade
        ctx.fillStyle = 'rgba(0, 0, 0, 0.15)'; 
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        particles.forEach(p => {
            if (mouse.active) {
                const dx = p.x - mouse.x;
                const dy = p.y - mouse.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                if (dist < 200) {
                    const force = (200 - dist) / 1000;
                    p.vx += (dx / dist) * force;
                    p.vy += (dy / dist) * force;
                }
            }

            // Friction to keep things smooth
            p.vx *= 0.98;
            p.vy *= 0.98;

            p.x += p.vx;
            p.y += p.vy;

            // Bounce off walls
            if (s = p.x < 0 || p.x > canvas.width) p.vx *= -1;
            if (p.y < 0 || p.y > canvas.height) p.vy *= -1;

            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            ctx.fill();
        });

        requestAnimationFrame(animate);
    }

    window.addEventListener('resize', resize);
    resize();
    animate();
</script>
</body>
</html>
